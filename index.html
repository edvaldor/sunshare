<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SunShare Demo Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    :root {
      --sunshare-accent: #f8b94a;
      --sunshare-accent-soft: #fff3cd;
    }

    body {
      background: linear-gradient(180deg, rgba(255, 243, 205, 0.45) 0%, #ffffff 40%);
      min-height: 100vh;
      color: #1f2933;
    }

    header {
      background: linear-gradient(135deg, rgba(255, 209, 102, 0.85), rgba(255, 159, 28, 0.85));
      color: #212529;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .sun-icon {
      font-size: 2.5rem;
    }

    .card {
      box-shadow: 0 0.5rem 1rem rgba(248, 185, 74, 0.1);
      border: none;
    }

    .card:hover {
      transform: translateY(-4px);
      transition: transform 0.2s ease-in-out;
      cursor: pointer;
    }

    .card-body p {
      margin-bottom: 0.35rem;
    }

    .energy-highlight {
      font-weight: 600;
      color: #c27c16;
    }

    .wallet-balance {
      font-size: 1.5rem;
      font-weight: 700;
      color: #f08f13;
    }

    textarea[readonly] {
      background-color: #fff7e6;
      border-color: #f5c069;
    }
  </style>
</head>
<body>
  <header class="py-5 mb-4">
    <div class="container text-center">
      <div class="sun-icon mb-3">☀️</div>
      <h1 class="display-5 fw-bold">☀️ SunShare</h1>
      <p class="lead mb-2">Energy you feel. Results you see.</p>
      <p class="mb-0">Invest in community solar energy with real-time blockchain transparency.</p>
    </div>
  </header>

  <main class="container pb-5">
    <section class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-semibold">Solar Panel Portfolio</h2>
        <span class="badge text-bg-warning text-dark">Live Simulation</span>
      </div>
      <div class="row g-4" id="panelCards">
        <!-- Panel cards injected by JS -->
      </div>
    </section>

    <section class="row g-4 mb-5">
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <i class="bi bi-wallet2 fs-2 text-warning me-3"></i>
              <h3 class="h5 mb-0">Wallet</h3>
            </div>
            <p class="text-success fw-semibold mb-1">Solana Wallet Connected</p>
            <p class="text-muted mb-4">Account: <span class="fw-medium">sunshare_demo.sol</span></p>
            <div class="wallet-balance mb-3">
              <span id="usdcBalance">120.00</span> <span class="fs-6">USDC</span>
            </div>
            <button id="withdrawBtn" class="btn btn-outline-warning fw-semibold">
              <i class="bi bi-cash-stack me-2"></i>Withdraw Rewards
            </button>
            <div class="text-muted small mt-2">Rewards accrue automatically from panel energy sales.</div>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <i class="bi bi-people fs-2 text-warning me-3"></i>
              <h3 class="h5 mb-0">Governance Vote</h3>
            </div>
            <p class="text-muted">Select the next community solar project to support.</p>
            <div class="mb-3">
              <label for="governanceSelect" class="form-label">Select new community to support</label>
              <select id="governanceSelect" class="form-select">
                <option selected disabled value="">Choose...</option>
                <option>Recife Rooftop Cooperative</option>
                <option>Curitiba Smart Microgrid</option>
                <option>Manaus Riverbank Solar Initiative</option>
              </select>
            </div>
            <button id="voteBtn" class="btn btn-warning fw-semibold">
              <i class="bi bi-send-check me-2"></i>Submit Vote
            </button>
            <div id="voteAlert" class="alert alert-success alert-dismissible fade mt-3 d-none" role="alert">
              <i class="bi bi-check-circle-fill me-2"></i>Vote recorded on-chain. Thank you for participating!
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="mb-5">
      <h3 class="h5 mb-3">Technical Notes</h3>
      <textarea class="form-control" rows="4" readonly>
Integration: Solana blockchain with SPL tokens.
IoT oracles send energy data to smart contracts.
Automatic payouts in USDC-SPL to all token holders.
      </textarea>
    </section>
  </main>

  <!-- Panel Details Modal -->
  <div class="modal fade" id="panelModal" tabindex="-1" aria-labelledby="panelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-warning bg-opacity-25">
          <h5 class="modal-title" id="panelModalLabel">Panel Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <h4 id="modalPanelName" class="h5 fw-semibold mb-0"></h4>
            <p class="text-muted mb-1"><i class="bi bi-geo-alt me-2"></i><span id="modalPanelLocation"></span></p>
          </div>
          <div class="row g-3">
            <div class="col-12 col-sm-6">
              <div class="border rounded p-3">
                <div class="text-muted small">Total Energy Generated</div>
                <div class="fw-bold" id="modalTotalEnergy"></div>
              </div>
            </div>
            <div class="col-12 col-sm-6">
              <div class="border rounded p-3">
                <div class="text-muted small">Tokens Sold / Available</div>
                <div class="fw-bold" id="modalTokens"></div>
              </div>
            </div>
            <div class="col-12">
              <div class="border rounded p-3">
                <div class="text-muted small">Real-time Reward (USDC)</div>
                <div class="fw-bold text-success" id="modalReward"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-warning fw-semibold"><i class="bi bi-coin me-2"></i>Invest Now</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    const panels = [
      {
        id: 'panelA',
        name: 'Panel A - São Paulo',
        location: 'São Paulo, Brazil',
        energyToday: 128.4,
        monthlyReturn: 8.2,
        totalEnergy: 4860,
        tokensSold: 430,
        tokensAvailable: 70,
        reward: 112.34
      },
      {
        id: 'panelB',
        name: 'Panel B - Fortaleza',
        location: 'Fortaleza, Brazil',
        energyToday: 142.9,
        monthlyReturn: 7.8,
        totalEnergy: 5094,
        tokensSold: 380,
        tokensAvailable: 120,
        reward: 96.24
      },
      {
        id: 'panelC',
        name: 'Panel C - Belo Horizonte',
        location: 'Belo Horizonte, Brazil',
        energyToday: 119.7,
        monthlyReturn: 9.1,
        totalEnergy: 4625,
        tokensSold: 460,
        tokensAvailable: 40,
        reward: 127.88
      }
    ];

    let userUsdcBalance = 120.0;
    const panelCardsContainer = document.getElementById('panelCards');

    const formatEnergy = (value) => `${value.toFixed(2)} kWh`;
    const formatCurrency = (value) => `${value.toFixed(2)} USDC`;

    const renderCards = () => {
      panelCardsContainer.innerHTML = panels.map(panel => `
        <div class="col-md-6 col-xl-4">
          <div class="card h-100" data-panel-id="${panel.id}">
            <img src="https://via.placeholder.com/400x200" class="card-img-top" alt="Solar panel ${panel.name}">
            <div class="card-body">
              <h5 class="card-title mb-1">${panel.name}</h5>
              <p class="text-muted"><i class="bi bi-geo-alt me-2"></i>${panel.location}</p>
              <p class="mb-1"><i class="bi bi-lightning-charge-fill text-warning me-2"></i>Energy Today: <span class="energy-highlight" data-energy="${panel.id}">${panel.energyToday.toFixed(2)}</span> kWh</p>
              <p class="mb-3"><i class="bi bi-bar-chart-line me-2 text-warning"></i>Expected Monthly Return: <strong>${panel.monthlyReturn.toFixed(1)}%</strong></p>
              <button class="btn btn-sm btn-warning fw-semibold buy-token" data-panel-id="${panel.id}"><i class="bi bi-coin me-1"></i>Buy 1 Token</button>
            </div>
          </div>
        </div>
      `).join('');
    };

    const panelModal = new bootstrap.Modal(document.getElementById('panelModal'));
    const modalPanelName = document.getElementById('modalPanelName');
    const modalPanelLocation = document.getElementById('modalPanelLocation');
    const modalTotalEnergy = document.getElementById('modalTotalEnergy');
    const modalTokens = document.getElementById('modalTokens');
    const modalReward = document.getElementById('modalReward');

    const openPanelModal = (panelId) => {
      const panel = panels.find(p => p.id === panelId);
      if (!panel) return;
      modalPanelName.textContent = panel.name;
      modalPanelLocation.textContent = panel.location;
      modalTotalEnergy.textContent = formatEnergy(panel.totalEnergy);
      modalTokens.textContent = `${panel.tokensSold} / ${panel.tokensAvailable}`;
      modalReward.textContent = formatCurrency(panel.reward);
      panelModal.show();
    };

    const updateEnergyDisplays = () => {
      panels.forEach(panel => {
        const energyElement = document.querySelector(`[data-energy="${panel.id}"]`);
        if (energyElement) {
          energyElement.textContent = panel.energyToday.toFixed(2);
        }
        if (modalPanelName.textContent === panel.name) {
          modalTotalEnergy.textContent = formatEnergy(panel.totalEnergy);
          modalReward.textContent = formatCurrency(panel.reward);
          modalTokens.textContent = `${panel.tokensSold} / ${panel.tokensAvailable}`;
        }
      });
    };

    const updateUsdcBalance = () => {
      document.getElementById('usdcBalance').textContent = userUsdcBalance.toFixed(2);
    };

    const startSimulation = () => {
      setInterval(() => {
        panels.forEach(panel => {
          const energyIncrement = Math.random() * 1.8 + 0.2; // 0.2 - 2.0 kWh
          const rewardIncrement = energyIncrement * 0.08; // simple coefficient for demo rewards
          panel.energyToday += energyIncrement;
          panel.totalEnergy += energyIncrement;
          panel.reward += rewardIncrement;
        });

        const walletIncrement = Math.random() * 0.35 + 0.05;
        userUsdcBalance += walletIncrement;

        updateEnergyDisplays();
        updateUsdcBalance();
      }, 3000);
    };

    panelCardsContainer.addEventListener('click', (event) => {
      const target = event.target;
      const card = target.closest('[data-panel-id]');
      if (!card) return;

      if (target.classList.contains('buy-token')) {
        const panel = panels.find(p => p.id === target.dataset.panelId);
        if (panel) {
          panel.tokensSold += 1;
          panel.tokensAvailable = Math.max(panel.tokensAvailable - 1, 0);
          userUsdcBalance -= 15; // mock purchase cost
          if (userUsdcBalance < 0) userUsdcBalance = 0;
          updateUsdcBalance();
          updateEnergyDisplays();
          const toast = document.createElement('div');
          toast.className = 'toast align-items-center text-bg-warning border-0 position-fixed bottom-0 end-0 m-3';
          toast.setAttribute('role', 'alert');
          toast.innerHTML = `
            <div class="d-flex">
              <div class="toast-body">
                <i class="bi bi-coin me-2"></i>1 token purchased for ${panel.name}!
              </div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>`;
          document.body.appendChild(toast);
          const toastInstance = new bootstrap.Toast(toast, { delay: 2500 });
          toastInstance.show();
          toast.addEventListener('hidden.bs.toast', () => toast.remove());
        }
      } else {
        openPanelModal(card.dataset.panelId);
      }
    });

    document.getElementById('withdrawBtn').addEventListener('click', () => {
      if (userUsdcBalance <= 0.01) {
        alert('No rewards available to withdraw yet.');
        return;
      }
      alert(`Withdrew ${userUsdcBalance.toFixed(2)} USDC to your connected wallet.`);
      userUsdcBalance = 0;
      updateUsdcBalance();
    });

    document.getElementById('voteBtn').addEventListener('click', () => {
      const voteAlert = document.getElementById('voteAlert');
      const governanceSelect = document.getElementById('governanceSelect');
      if (!governanceSelect.value) {
        alert('Please select a community to support before submitting your vote.');
        return;
      }
      voteAlert.classList.remove('d-none');
      voteAlert.classList.add('show');
    });

    renderCards();
    updateUsdcBalance();
    startSimulation();
  </script>
</body>
</html>
